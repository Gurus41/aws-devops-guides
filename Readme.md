# Merging Multiple Sites into One Server on AWS EC2

## Step-by-Step Process

### Step 1: Launch an EC2 Instance
1. Log in to the AWS Management Console.
2. Navigate to the EC2 service.
3. Click on "Launch Instance."
4. Name the instance (e.g., "server").
5. Select the Red Hat Enterprise Linux AMI (free tier eligible).
6. Choose the instance type: `t2.micro`.
7. Select an existing key pair for SSH access (or create a new one).
8. Use default network settings and security group (ensure port 80 is open for HTTP traffic).
9. Launch the instance.
10. Wait for the instance to be in a "running" state.

### Step 2: Connect to the EC2 Instance via SSH
1. Note the public IPv4 address or DNS of the instance from the AWS console.
2. Open a terminal on your local machine.
3. Use SSH to connect:
   ```bash
   ssh -i your-key-pair.pem ec2-user@your-instance-public-ip
   ```
   Replace `your-key-pair.pem` with your key file and `your-instance-public-ip` with the actual IP.
4. Once connected, verify the system:
   ```bash
   uname -a
   ```
   This confirms the system is running Red Hat Linux.

### Step 3: Update the System and Install Required Packages
1. Register the system with Red Hat Subscription Manager (if needed):
   ```bash
   sudo subscription-manager register --auto-attach
   ```
2. Update the system repositories and packages:
   ```bash
   sudo yum update -y
   ```
3. Install Apache HTTP Server:
   ```bash
   sudo yum install httpd -y
   ```
4. Start the Apache service:
   ```bash
   sudo systemctl start httpd
   ```
5. Enable Apache to start on boot:
   ```bash
   sudo systemctl enable httpd
   ```
6. Check the service status:
   ```bash
   sudo systemctl status httpd
   ```
   Ensure it shows as "active (running)."

### Step 4: Configure Virtual Hosting for Multiple Sites
Virtual hosting allows multiple websites to share the same server and IP address, differentiated by domain names.

1. Create directories for sample websites under `/var/www/html/`:
   ```bash
   sudo mkdir /var/www/html/amazon
   sudo mkdir /var/www/html/flipkart
   sudo mkdir /var/www/html/myntra
   ```
2. Create a basic `index.html` file for each site:
   - For Amazon:
     ```bash
     echo "<h1>Amazon</h1>" | sudo tee /var/www/html/amazon/index.html
     ```
   - For Flipkart:
     ```bash
     echo "<h1>Flipkart</h1>" | sudo tee /var/www/html/flipkart/index.html
     ```
   - For Myntra:
     ```bash
     echo "<h1>Myntra</h1>" | sudo tee /var/www/html/myntra/index.html
     ```

### Step 5: Set Up Virtual Host Configuration Files
1. Navigate to the Apache configuration directory:
   ```bash
   cd /etc/httpd/conf.d/
   ```
2. Create a configuration file for each virtual host:
   - For Amazon:
     ```bash
     sudo nano amazon.conf
     ```
     Add the following content:
     ```
     <VirtualHost *:80>
         ServerName amazon123.com
         DocumentRoot /var/www/html/amazon
     </VirtualHost>
     ```
   - For Flipkart:
     ```bash
     sudo nano flipkart.conf
     ```
     Add the following content:
     ```
     <VirtualHost *:80>
         ServerName flipkart123.in
         DocumentRoot /var/www/html/flipkart
     </VirtualHost>
     ```
   - For Myntra:
     ```bash
     sudo nano myntra.conf
     ```
     Add the following content:
     ```
     <VirtualHost *:80>
         ServerName myntra123.org
         DocumentRoot /var/www/html/myntra
     </VirtualHost>
     ```
3. Save and exit the editor for each file.

### Step 6: Restart Apache and Test the Configuration
1. Restart the Apache service to apply changes:
   ```bash
   sudo systemctl restart httpd
   sudo systemctl status httpd    # optional – check it's active (running)
   ```

2. Test the sites in two stages:
   - **Basic test (no domain trick needed):**
     - Open a browser and type: `http://<your-ec2-public-ip>`
     - You should see the default Apache page (or `index.html` from `/var/www/html`).

   - **Test your fake domains (amazon123.com, etc.):**
     - Your computer doesn't know these domains, so tell it manually by editing your hosts file. Add these 3 lines (use your real EC2 IP):
       ```text
       3.110.45.67    amazon123.com
       3.110.45.67    flipkart123.in
       3.110.45.67    myntra123.org
       ```

3. Now your browser thinks `amazon123.com` = your EC2 server. Visit the following in your browser:
   - `http://amazon123.com`
   - `http://flipkart123.in`
   - `http://myntra123.org`

   Each should show its own `<h1>` content (Amazon / Flipkart / Myntra).

4. **Quick verification (optional but recommended):**
   - Open browser DevTools (F12) → Network tab.
   - Reload the page → look for `200 OK` status.
   - Check Request Headers → confirm the correct `Host:` value.

5. **Quick Hosts File Locations & Commands:**
   - **Windows:**
     - Path: `C:\Windows\System32\drivers\etc\hosts`
     - Run Notepad as Administrator to edit.
     - After saving: `ipconfig /flushdns` (in cmd).
   - **macOS:**
     - Run:
       ```bash
       sudo nano /etc/hosts
       ```
     - Add lines → `Ctrl+O` → Enter → `Ctrl+X`.
     - Then:
       ```bash
       sudo dscacheutil -flushcache; sudo killall -HUP mDNSResponder
       ```
   - **Linux:**
     - Run:
       ```bash
       sudo nano /etc/hosts
       ```
     - Add lines → `Ctrl+O` → Enter → `Ctrl+X`.
     - Then:
       ```bash
       sudo systemd-resolve --flush-caches    # or
       sudo resolvectl flush-caches
       ```

   Done! All three fake domains should now resolve to your EC2 instance locally.

### Step 7: Analyze Logs for Monitoring and Troubleshooting
1. View access logs:
   ```bash
   sudo tail -f /var/log/httpd/access_log
   ```
2. View error logs:
   ```bash
   sudo tail -f /var/log/httpd/error_log
   ```
3. Monitor for GET requests, status codes (e.g., 200 for success, 304 for cached), and client details.

### Step 8: Cost Optimization Insights
1. By hosting multiple sites on one EC2 instance, you avoid the cost of multiple servers.
2. Monitor AWS costs via the console to see savings.
3. Scale as needed by upgrading instance types or using Auto Scaling.

## Troubleshooting Tips
- If Apache fails to start, check syntax:
  ```bash
  sudo apachectl configtest
  ```
- Ensure security group allows inbound HTTP (port 80) from your IP.
- Permissions issues: Use
  ```bash
  sudo chown -R apache:apache /var/www/html/
  ```
  if needed.
- Logs are key for debugging 404 errors or misconfigurations.

## Terminate the EC2 Instance

Once you are done with the EC2 instance, terminate it to avoid unnecessary charges:

1. Go to the AWS Management Console and open the EC2 service.
2. Select the instance you want to terminate from the "Instances" list.
3. Click on "Instance state" and choose "Terminate instance."
4. Confirm the termination when prompted.

   **Note:** Ensure you have backed up any important data before terminating the instance, as this action cannot be undone.

## Next Steps
- Practice by adding more sites or real domains (using Route 53 for DNS).
- Explore advanced topics like SSL (HTTPS) with Let's Encrypt.

## Resources
- [AWS Documentation: EC2 User Guide](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/)
- [Apache Documentation: Virtual Hosts](https://httpd.apache.org/docs/current/vhosts/)